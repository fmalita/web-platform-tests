<!DOCTYPE html>
<!-- This test verifies observable CORB impact on <link rel="preload"> elements.
-->
<meta charset="utf-8">
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<div id=log></div>

<script>
async_test(function(t) {
  window.preloadErrorEvent = function() {
    // With CORB the link.onerror event will be reached
    // (because CORB will block the cross-origin preload).
    t.done();
  }
  window.preloadLoadEvent = function() {
    // Without CORB the link.onload event will be reached.
    assert_unreached("link/preload onload event reached.");
    t.done();
  }
});
</script>

<!-- www1 is cross-origin, so the HTTP response is CORB-eligible -->
<link rel="preload" as="image"
      onerror="preloadErrorEvent()"
      onload="preloadLoadEvent()"
      href="http://{{domains[www1]}}:{{ports[http][0]}}/fetch/corb/resources/png-mislabeled-as-html-nosniff.png">

<!--
  Presence of the <img> element is not strictly required by the test,
  but it is included to avoid the warning below:
    CONSOLE WARNING: The resource .../png-mislabeled-as-html-nosniff.png was
    preloaded using link preload but not used within a few seconds from the
    window's load event. Please make sure it has an appropriate `as` value and
    it is preloaded intentionally.  -->
<img src="http://{{domains[www1]}}:{{ports[http][0]}}/fetch/corb/resources/png-mislabeled-as-html-nosniff.png">
